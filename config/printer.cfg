[include fluidd.cfg]
[include macros/*]
[include SO3.cfg]
[include eddy.cfg]

#[force_move]
#enable_force_move: True

[stepper_x]
step_pin: PB13
dir_pin: !PB12
enable_pin: !PB14
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC0 
position_endstop: 0
position_max: 235
homing_speed: 50

[tmc2209 stepper_x]
uart_pin: PC11
tx_pin: PC10
uart_address: 0
run_current: 0.580
stealthchop_threshold: 999999

[stepper_y]
step_pin: PB10
dir_pin: !PB2
enable_pin: !PB11
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC1 
position_endstop: 0
position_max: 232  #JWD - 02/23/2026 - adjusted after hearing motor click at 232
homing_speed: 50

[tmc2209 stepper_y]
uart_pin: PC11
tx_pin: PC10
uart_address: 2
run_current: 0.580
stealthchop_threshold: 999999

[stepper_z]
step_pin: PB0
dir_pin: PC5
enable_pin: !PB1
microsteps: 16
rotation_distance: 8
endstop_pin: probe:z_virtual_endstop #JWD - 02/22/2026 changed for EDDY setup
#position_endstop: 0.0 #JWD - 02/22/2026 changed for EDDY setup
position_max: 250

[tmc2209 stepper_z]
uart_pin: PC11
tx_pin: PC10
uart_address: 1
run_current: 0.58 #JWD - 02/23/2026 - changed from 0.580 after testing
hold_current: 0.5
stealthchop_threshold: 999999 #JWD - 02/23/2026 - changed from 999999 after testing

[stepper_z1]
step_pin: PB3
dir_pin: PB4
enable_pin: !PD1
microsteps: 16
rotation_distance: 8
#position_max: 250

[tmc2209 stepper_z1]
uart_pin: PC11
tx_pin: PC10
uart_address: 3
run_current: 0.85
hold_current: 0.5
stealthchop_threshold: 999999

# [extruder] - JWD - 02/22/2026 - Extruder config is in SO3.cfg

[heater_bed]
heater_pin: PC9
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC4
#control: pid
# tuned for stock hardware with 50 degree Celsius target
#pid_Kp: 54.027
#pid_Ki: 0.770
#pid_Kd: 948.182
min_temp: 0
max_temp: 130

#JWD - 02/22/2026 - heater fan is controlled by SO3
#[heater_fan heatbreak_cooling_fan]
#pin: PC7

#[heater_fan controller_fan]
#pin: PB15

#[fan]
#pin: PC6

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_2B004C0012504D5930313820-if00
restart_method: command

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 2000
max_z_velocity: 15
max_z_accel: 100

######################################################################
# 128x64 Full Graphic Creality CR10 / ENDER 3 stockdisplay
######################################################################

# This section is used for a Creality "12864" display with a single
# ribbon cable between the display's EXP3 plug and the
# micro-controller board's EXP1 connector.

#JWD - 02/22/2026 - Dislplay currently broken
#[display]
#lcd_type: st7920
#cs_pin: EXP1_7
#sclk_pin: EXP1_6
#sid_pin: EXP1_8
#encoder_pins: ^EXP1_5, ^EXP1_3
#click_pin: ^!EXP1_2

#====================================================================
# Raspberry Pi Temperature Display for Mainsail
#====================================================================

[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[output_pin beeper]
pin: EXP1_1

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8, EXP1_9=<GND>,
    EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PD6, EXP1_10=<5V>
[display_status]

#JWD - 02/22/2026 - bltouch replaced with EDDY probe
#[bltouch]
#sensor_pin: ^PB1
#control_pin: PB0
#x_offset: -40
#y_offset: -12
#z_offset: 0
#pin_up_touch_mode_reports_triggered: False  # Add for BLTouch v3 or clones
#probe_with_touch_mode: true
#stow_on_each_sample: false

#JWD - 2/22/2026 - bed_mesh in eddy.cfg
#[bed_mesh]
#speed: 120
#mesh_min: 10, 10
#mesh_max: 195, 215
#probe_count: 5,5
#algorithm: bicubic

#JWD - 02/22/2026 - safe_z_home in eddy.cfg
#[safe_z_home]
#x=middle of the plate -(x prob offset) = 117.5 - (-40) = 157
#y=middle of the plate - (y prob offset) = 117.5 - (-12) = 129
#home_xy_position: 157, 129
#speed: 75
#z_hop: 10
#z_hop_speed: 15

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3226552.645,0.090000:3225936.162,0.130000:3225316.586,
#*# 	0.170000:3224681.583,0.210000:3224063.634,0.250000:3223424.484,
#*# 	0.290000:3222811.621,0.330000:3222210.066,0.370000:3221594.807,
#*# 	0.410000:3220999.267,0.450000:3220403.684,0.490000:3219811.435,
#*# 	0.530000:3219246.626,0.570000:3218683.409,0.610000:3218117.133,
#*# 	0.650000:3217542.987,0.690000:3217011.888,0.730000:3216468.311,
#*# 	0.770000:3215930.843,0.810000:3215393.493,0.850000:3214883.312,
#*# 	0.890000:3214371.804,0.930000:3213865.585,0.970000:3213370.875,
#*# 	1.010000:3212892.609,1.050000:3212413.727,1.090000:3211938.447,
#*# 	1.130000:3211474.199,1.170000:3211032.197,1.210000:3210572.619,
#*# 	1.250000:3210130.448,1.290000:3209702.328,1.330000:3209298.953,
#*# 	1.370000:3208871.445,1.410000:3208466.023,1.450000:3208067.787,
#*# 	1.490000:3207694.480,1.530000:3207306.032,1.570000:3206907.502,
#*# 	1.610000:3206550.172,1.650000:3206198.541,1.690000:3205845.158,
#*# 	1.730000:3205487.022,1.770000:3205150.241,1.810000:3204823.512,
#*# 	1.850000:3204494.727,1.890000:3204172.011,1.930000:3203852.520,
#*# 	1.970000:3203551.805,2.010000:3203253.672,2.050000:3202962.288,
#*# 	2.090000:3202667.427,2.130000:3202391.389,2.170000:3202109.313,
#*# 	2.210000:3201837.219,2.250000:3201547.855,2.290000:3201274.424,
#*# 	2.330000:3201008.956,2.370000:3200732.861,2.410000:3200468.792,
#*# 	2.450000:3200205.381,2.490000:3199955.971,2.530000:3199681.889,
#*# 	2.570000:3199431.810,2.610000:3199184.400,2.650000:3198949.005,
#*# 	2.690000:3198709.592,2.730000:3198473.543,2.770000:3198245.480,
#*# 	2.810000:3198016.738,2.850000:3197792.616,2.890000:3197565.264,
#*# 	2.930000:3197351.847,2.970000:3197136.455,3.010000:3196927.668,
#*# 	3.050000:3196710.377,3.090000:3196511.600,3.130000:3196310.127,
#*# 	3.170000:3196110.817,3.210000:3195905.428,3.250000:3195719.318,
#*# 	3.290000:3195518.600,3.330000:3195341.213,3.370000:3195157.199,
#*# 	3.410000:3194979.143,3.450000:3194810.929,3.490000:3194631.032,
#*# 	3.530000:3194454.950,3.570000:3194287.558,3.610000:3194122.174,
#*# 	3.650000:3193958.834,3.690000:3193793.292,3.730000:3193638.750,
#*# 	3.770000:3193486.669,3.810000:3193330.611,3.850000:3193174.671,
#*# 	3.890000:3193032.532,3.930000:3192883.201,3.970000:3192729.718,
#*# 	4.010000:3192595.779,4.050000:3192456.329
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 35.801590
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 71.452
#*# pid_ki = 1.280
#*# pid_kd = 996.749
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.229580, -0.151523, -0.135183, -0.094279, -0.031182, -0.033508, 0.047179, 0.100655, 0.124568
#*# 	-0.164808, -0.091813, -0.070138, -0.029444, 0.046568, 0.047179, 0.120228, 0.166549, 0.162247
#*# 	-0.084999, -0.004498, -0.006234, 0.020792, 0.071363, 0.051289, 0.110437, 0.145586, 0.141299
#*# 	-0.015523, 0.045977, 0.039977, 0.055179, 0.098472, 0.078616, 0.128919, 0.160108, 0.128916
#*# 	0.007105, 0.086417, 0.081953, 0.098472, 0.139134, 0.111524, 0.164926, 0.198355, 0.185416
#*# 	0.088655, 0.148268, 0.138059, 0.143980, 0.185945, 0.153650, 0.197260, 0.225174, 0.198887
#*# 	0.198873, 0.232677, 0.210201, 0.198872, 0.216094, 0.160108, 0.184870, 0.201563, 0.170329
#*# 	0.171393, 0.223575, 0.203736, 0.198852, 0.228940, 0.188103, 0.216080, 0.242325, 0.206952
#*# 	0.189181, 0.234256, 0.216077, 0.216077, 0.238562, 0.187571, 0.221962, 0.243901, 0.223575
#*# x_count = 9
#*# y_count = 9
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 210.0
#*# min_y = 40.0
#*# max_y = 200.0
