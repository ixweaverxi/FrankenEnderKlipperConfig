[include fluidd.cfg]
[include macros/*]
[include SO3.cfg]
[include eddy.cfg]

#[force_move]
#enable_force_move: True

[stepper_x]
step_pin: PB13
dir_pin: !PB12
enable_pin: !PB14
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC0 
position_endstop: 0
position_max: 235
homing_speed: 50

[tmc2209 stepper_x]
uart_pin: PC11
tx_pin: PC10
uart_address: 0
run_current: 0.580
stealthchop_threshold: 999999

[stepper_y]
step_pin: PB10
dir_pin: !PB2
enable_pin: !PB11
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC1 
position_endstop: 0
position_max: 232  #JWD - 02/23/2026 - adjusted after hearing motor click at 232
homing_speed: 50

[tmc2209 stepper_y]
uart_pin: PC11
tx_pin: PC10
uart_address: 2
run_current: 0.580
stealthchop_threshold: 999999

[stepper_z]
step_pin: PB0
dir_pin: PC5
enable_pin: !PB1
microsteps: 16
rotation_distance: 8
endstop_pin: probe:z_virtual_endstop #JWD - 02/22/2026 changed for EDDY setup
#position_endstop: 0.0 #JWD - 02/22/2026 changed for EDDY setup
position_max: 250

[tmc2209 stepper_z]
uart_pin: PC11
tx_pin: PC10
uart_address: 1
run_current: 0.58 #JWD - 02/23/2026 - changed from 0.580 after testing
hold_current: 0.5
stealthchop_threshold: 999999 #JWD - 02/23/2026 - changed from 999999 after testing

[stepper_z1]
step_pin: PB3
dir_pin: PB4
enable_pin: !PD1
microsteps: 16
rotation_distance: 8
#position_max: 250

[tmc2209 stepper_z1]
uart_pin: PC11
tx_pin: PC10
uart_address: 3
run_current: 0.85
hold_current: 0.5
stealthchop_threshold: 999999

# [extruder] - JWD - 02/22/2026 - Extruder config is in SO3.cfg

[heater_bed]
heater_pin: PC9
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC4
#control: pid
# tuned for stock hardware with 50 degree Celsius target
#pid_Kp: 54.027
#pid_Ki: 0.770
#pid_Kd: 948.182
min_temp: 0
max_temp: 130

#JWD - 02/22/2026 - heater fan is controlled by SO3
#[heater_fan heatbreak_cooling_fan]
#pin: PC7

#[heater_fan controller_fan]
#pin: PB15

#[fan]
#pin: PC6

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_2B004C0012504D5930313820-if00
restart_method: command

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 2000
max_z_velocity: 15
max_z_accel: 100

######################################################################
# 128x64 Full Graphic Creality CR10 / ENDER 3 stockdisplay
######################################################################

# This section is used for a Creality "12864" display with a single
# ribbon cable between the display's EXP3 plug and the
# micro-controller board's EXP1 connector.

#JWD - 02/22/2026 - Dislplay currently broken
#[display]
#lcd_type: st7920
#cs_pin: EXP1_7
#sclk_pin: EXP1_6
#sid_pin: EXP1_8
#encoder_pins: ^EXP1_5, ^EXP1_3
#click_pin: ^!EXP1_2

#====================================================================
# Raspberry Pi Temperature Display for Mainsail
#====================================================================

[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[output_pin beeper]
pin: EXP1_1

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8, EXP1_9=<GND>,
    EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PD6, EXP1_10=<5V>
[display_status]

#JWD - 02/22/2026 - bltouch replaced with EDDY probe
#[bltouch]
#sensor_pin: ^PB1
#control_pin: PB0
#x_offset: -40
#y_offset: -12
#z_offset: 0
#pin_up_touch_mode_reports_triggered: False  # Add for BLTouch v3 or clones
#probe_with_touch_mode: true
#stow_on_each_sample: false

#JWD - 2/22/2026 - bed_mesh in eddy.cfg
#[bed_mesh]
#speed: 120
#mesh_min: 10, 10
#mesh_max: 195, 215
#probe_count: 5,5
#algorithm: bicubic

#JWD - 02/22/2026 - safe_z_home in eddy.cfg
#[safe_z_home]
#x=middle of the plate -(x prob offset) = 117.5 - (-40) = 157
#y=middle of the plate - (y prob offset) = 117.5 - (-12) = 129
#home_xy_position: 157, 129
#speed: 75
#z_hop: 10
#z_hop_speed: 15

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3232272.996,0.090000:3231571.591,0.130000:3230845.213,
#*# 	0.170000:3230151.347,0.210000:3229454.573,0.250000:3228745.140,
#*# 	0.290000:3228061.406,0.330000:3227362.003,0.370000:3226678.326,
#*# 	0.410000:3225976.174,0.450000:3225329.279,0.490000:3224650.659,
#*# 	0.530000:3224009.603,0.570000:3223353.567,0.610000:3222709.211,
#*# 	0.650000:3222084.063,0.690000:3221463.872,0.730000:3220846.395,
#*# 	0.770000:3220240.206,0.810000:3219645.631,0.850000:3219079.964,
#*# 	0.890000:3218511.776,0.930000:3217950.894,0.970000:3217390.079,
#*# 	1.010000:3216841.761,1.050000:3216291.278,1.090000:3215764.314,
#*# 	1.130000:3215232.704,1.170000:3214715.312,1.210000:3214208.454,
#*# 	1.250000:3213706.967,1.290000:3213218.075,1.330000:3212744.540,
#*# 	1.370000:3212267.214,1.410000:3211809.661,1.450000:3211352.273,
#*# 	1.490000:3210908.704,1.530000:3210468.603,1.570000:3210033.760,
#*# 	1.610000:3209604.972,1.650000:3209189.448,1.690000:3208774.030,
#*# 	1.730000:3208376.562,1.770000:3207975.887,1.810000:3207596.326,
#*# 	1.850000:3207217.587,1.890000:3206843.430,1.930000:3206467.262,
#*# 	1.970000:3206108.544,2.010000:3205734.382,2.050000:3205382.341,
#*# 	2.090000:3205036.257,2.130000:3204692.105,2.170000:3204368.695,
#*# 	2.210000:3204027.947,2.250000:3203698.504,2.290000:3203387.035,
#*# 	2.330000:3203077.623,2.370000:3202767.509,2.410000:3202460.768,
#*# 	2.450000:3202161.966,2.490000:3201883.897,2.530000:3201596.486,
#*# 	2.570000:3201309.725,2.610000:3201040.370,2.650000:3200764.872,
#*# 	2.690000:3200488.798,2.730000:3200218.048,2.770000:3199985.987,
#*# 	2.810000:3199696.555,2.850000:3199449.148,2.890000:3199191.738,
#*# 	2.930000:3198946.341,2.970000:3198701.599,3.010000:3198455.508,
#*# 	3.050000:3198228.146,3.090000:3197992.745,3.130000:3197777.960,
#*# 	3.170000:3197559.929,3.210000:3197331.176,3.250000:3197120.444,
#*# 	3.290000:3196903.674,3.330000:3196693.665,3.370000:3196490.264,
#*# 	3.410000:3196282.153,3.450000:3196088.813,3.490000:3195894.123,
#*# 	3.530000:3195700.675,3.570000:3195506.655,3.610000:3195329.930,
#*# 	3.650000:3195144.536,3.690000:3194961.784,3.730000:3194795.712,
#*# 	3.770000:3194604.975,3.810000:3194454.950,3.850000:3194277.588,
#*# 	3.890000:3194114.828,3.930000:3193948.156,3.970000:3193789.412,
#*# 	4.010000:3193617.994,4.050000:3193475.339
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 33.964808
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 71.452
#*# pid_ki = 1.280
#*# pid_kd = 996.749
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.229580, -0.151523, -0.135183, -0.094279, -0.031182, -0.033508, 0.047179, 0.100655, 0.124568
#*# 	  -0.164808, -0.091813, -0.070138, -0.029444, 0.046568, 0.047179, 0.120228, 0.166549, 0.162247
#*# 	  -0.084999, -0.004498, -0.006234, 0.020792, 0.071363, 0.051289, 0.110437, 0.145586, 0.141299
#*# 	  -0.015523, 0.045977, 0.039977, 0.055179, 0.098472, 0.078616, 0.128919, 0.160108, 0.128916
#*# 	  0.007105, 0.086417, 0.081953, 0.098472, 0.139134, 0.111524, 0.164926, 0.198355, 0.185416
#*# 	  0.088655, 0.148268, 0.138059, 0.143980, 0.185945, 0.153650, 0.197260, 0.225174, 0.198887
#*# 	  0.198873, 0.232677, 0.210201, 0.198872, 0.216094, 0.160108, 0.184870, 0.201563, 0.170329
#*# 	  0.171393, 0.223575, 0.203736, 0.198852, 0.228940, 0.188103, 0.216080, 0.242325, 0.206952
#*# 	  0.189181, 0.234256, 0.216077, 0.216077, 0.238562, 0.187571, 0.221962, 0.243901, 0.223575
#*# x_count = 9
#*# y_count = 9
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 210.0
#*# min_y = 40.0
#*# max_y = 200.0
